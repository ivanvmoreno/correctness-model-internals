schema: '2.0'
stages:
  format_datasets:
    cmd: python -m src.stages.format_datasets --config=params.yaml
    deps:
    - path: ./datasets/raw
      hash: md5
      md5: 7f93c31ddb6c346dd79ece5a3bdcf9ac.dir
      size: 275957836
      nfiles: 563
    - path: src/stages/format_datasets.py
      hash: md5
      md5: 721378a9842218bb125df29fc54d2c4c
      size: 2227
    params:
      params.yaml:
        base:
          project_name: correctness-model-internals
          log_level: DEBUG
          models_dir: ../models
          datasets_dir: ./datasets
          generations_dir: ./generations
          evaluations_dir: ./evaluations
          activations_dir: ./activations
        datasets:
          mmlu:
            answer_type: multiple_choice
            answer_map:
            - A
            - B
            - C
            - D
            subsets:
            - high_school_mathematics
            - college_mathematics
            - abstract_algebra
            prompts:
              base: The following is a multiple choice question (with answers). Give
                your answer with a single letter corresponding to the correct answer.
          gsm8k:
            answer_type: open_ended
            answer_delim: '####'
            answer_regex: (?<=\$\\boxed\{)\d+(?=\}\$)
            subsets:
            - main
            prompts:
              base_3_shot: "Give your answer in this format: $\\boxed{answer}$\nHere
                are some examples to help you understand the format:\n---\nQuestion:
                Weng earns $12 an hour for babysitting. Yesterday, she just did 50
                minutes of babysitting. How much did she earn?\nAnswer: $\\boxed{10}$\n
                ---\nQuestion: Julie is reading a 120-page book. Yesterday, she was
                able to read 12 pages and today, she read twice as many pages as yesterday.
                If she wants to read half of the remaining pages tomorrow, how many
                pages should she read?\nAnswer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Answer: $\\boxed{35}$\n---\nQuestion:"
              cot_3_shot: "Think step by step about the following problem.\nGive your
                answer in this format: $\\boxed{answer}$\nHere are some examples to
                help you understand the format:\n---\nQuestion: Weng earns $12 an
                hour for babysitting. Yesterday, she just did 50 minutes of babysitting.
                How much did she earn?\nReasoning: Weng earns 12/60 = $12/60=0.20.2
                per minute. Working 50 minutes, she earned 0.2 x 50 = $0.2*50=1010.\n
                Final answer: $\\boxed{10}$\n---\nQuestion: Julie is reading a 120-page
                book. Yesterday, she was able to read 12 pages and today, she read
                twice as many pages as yesterday. If she wants to read half of the
                remaining pages tomorrow, how many pages should she read?\nReasoning:
                Julie read 12 x 2 = 12*2=2424 pages today. So she was able to read
                a total of 12 + 24 = 12+24=3636 pages since yesterday. There are 120
                - 36 = 120-36=8484 pages left to be read. Since she wants to read
                half of the remaining pages tomorrow, then she should read 84/2 =
                84/2=4242 pages.\nFinal answer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Reasoning: There are 80/100 * 10 = 80/100*10=88 more purple flowers
                than yellow flowers. So in Mark's garden, there are 10 + 8 = 10+8=1818
                purple flowers. Purple and yellow flowers sum up to 10 + 18 = 10+18=2828
                flowers. That means in Mark's garden there are 25/100 * 28 = 25/100*28=77
                green flowers. So in total Mark has 28 + 7 = 28+7=3535 plants in his
                garden.\nFinal answer: $\\boxed{35}$\n---\nQuestion:"
        format_datasets:
          raw_dir_path: raw
          formatted_dir_path: formatted
          generation_delimiter: false
    outs:
    - path: ./datasets/formatted
      hash: md5
      md5: dae3593c60f8f2be277e13a706b3891d.dir
      size: 26554358
      nfiles: 5
  generate_answers:
    cmd: python -m src.stages.generate_answers --config=params.yaml --model=llama3_3b_chat
    deps:
    - path: ./datasets/formatted
      hash: md5
      md5: d8a636d00988d54dfcc0877f78e54524.dir
      size: 26595234
      nfiles: 10
    - path: src/stages/generate_answers.py
      hash: md5
      md5: fbea02d500df3fdeb66e870f5f78dcb9
      size: 7738
    params:
      params.yaml:
        base:
          project_name: correctness-model-internals
          log_level: DEBUG
          models_dir: ../models
          datasets_dir: ./datasets
          generations_dir: ./generations
          evaluations_dir: ./evaluations
          activations_dir: ./activations
        datasets:
          mmlu:
            answer_type: multiple_choice
            answer_map:
            - A
            - B
            - C
            - D
            subsets:
            - high_school_mathematics
            - college_mathematics
            - abstract_algebra
            prompts:
              base: The following is a multiple choice question (with answers). Give
                your answer with a single letter corresponding to the correct answer.
          gsm8k:
            answer_type: open_ended
            answer_delim: '####'
            answer_regex: (?<=\$\\boxed\{)\d+(?=\}\$)
            subsets:
            - main
            prompts:
              base_3_shot: "Give your answer in this format: $\\boxed{answer}$\nHere
                are some examples to help you understand the format:\n---\nQuestion:
                Weng earns $12 an hour for babysitting. Yesterday, she just did 50
                minutes of babysitting. How much did she earn?\nAnswer: $\\boxed{10}$\n
                ---\nQuestion: Julie is reading a 120-page book. Yesterday, she was
                able to read 12 pages and today, she read twice as many pages as yesterday.
                If she wants to read half of the remaining pages tomorrow, how many
                pages should she read?\nAnswer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Answer: $\\boxed{35}$\n---\nQuestion:"
              cot_3_shot: "Think step by step about the following problem.\nGive your
                answer in this format: $\\boxed{answer}$\nHere are some examples to
                help you understand the format:\n---\nQuestion: Weng earns $12 an
                hour for babysitting. Yesterday, she just did 50 minutes of babysitting.
                How much did she earn?\nReasoning: Weng earns 12/60 = $12/60=0.20.2
                per minute. Working 50 minutes, she earned 0.2 x 50 = $0.2*50=1010.\n
                Final answer: $\\boxed{10}$\n---\nQuestion: Julie is reading a 120-page
                book. Yesterday, she was able to read 12 pages and today, she read
                twice as many pages as yesterday. If she wants to read half of the
                remaining pages tomorrow, how many pages should she read?\nReasoning:
                Julie read 12 x 2 = 12*2=2424 pages today. So she was able to read
                a total of 12 + 24 = 12+24=3636 pages since yesterday. There are 120
                - 36 = 120-36=8484 pages left to be read. Since she wants to read
                half of the remaining pages tomorrow, then she should read 84/2 =
                84/2=4242 pages.\nFinal answer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Reasoning: There are 80/100 * 10 = 80/100*10=88 more purple flowers
                than yellow flowers. So in Mark's garden, there are 10 + 8 = 10+8=1818
                purple flowers. Purple and yellow flowers sum up to 10 + 18 = 10+18=2828
                flowers. That means in Mark's garden there are 25/100 * 28 = 25/100*28=77
                green flowers. So in total Mark has 28 + 7 = 28+7=3535 plants in his
                garden.\nFinal answer: $\\boxed{35}$\n---\nQuestion:"
        format_datasets:
          raw_dir_path: raw
          formatted_dir_path: formatted
          generation_delimiter: false
        generate_answers:
          model: llama3_3b_chat
          max_dataset_size: 10
          sample_strategy: first_n
          max_new_tokens: 1024
          stop_word: '}$'
    outs:
    - path: ./generations
      hash: md5
      md5: c6f2e71bed965e5dd98da848a72997d3.dir
      size: 44490
      nfiles: 5
  evaluate_answers:
    cmd: python -m src.stages.evaluate_answers --config=params.yaml --model=llama3_3b_chat
    deps:
    - path: ./datasets/formatted
      hash: md5
      md5: d8a636d00988d54dfcc0877f78e54524.dir
      size: 26595234
      nfiles: 10
    - path: ./generations
      hash: md5
      md5: c6f2e71bed965e5dd98da848a72997d3.dir
      size: 44490
      nfiles: 5
    - path: src/stages/evaluate_answers.py
      hash: md5
      md5: 4c7e6d2e78bf03013806db915ec2c4db
      size: 6946
    params:
      params.yaml:
        base:
          project_name: correctness-model-internals
          log_level: DEBUG
          models_dir: ../models
          datasets_dir: ./datasets
          generations_dir: ./generations
          evaluations_dir: ./evaluations
          activations_dir: ./activations
        datasets:
          mmlu:
            answer_type: multiple_choice
            answer_map:
            - A
            - B
            - C
            - D
            subsets:
            - high_school_mathematics
            - college_mathematics
            - abstract_algebra
            prompts:
              base: The following is a multiple choice question (with answers). Give
                your answer with a single letter corresponding to the correct answer.
          gsm8k:
            answer_type: open_ended
            answer_delim: '####'
            answer_regex: (?<=\$\\boxed\{)\d+(?=\}\$)
            subsets:
            - main
            prompts:
              base_3_shot: "Give your answer in this format: $\\boxed{answer}$\nHere
                are some examples to help you understand the format:\n---\nQuestion:
                Weng earns $12 an hour for babysitting. Yesterday, she just did 50
                minutes of babysitting. How much did she earn?\nAnswer: $\\boxed{10}$\n
                ---\nQuestion: Julie is reading a 120-page book. Yesterday, she was
                able to read 12 pages and today, she read twice as many pages as yesterday.
                If she wants to read half of the remaining pages tomorrow, how many
                pages should she read?\nAnswer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Answer: $\\boxed{35}$\n---\nQuestion:"
              cot_3_shot: "Think step by step about the following problem.\nGive your
                answer in this format: $\\boxed{answer}$\nHere are some examples to
                help you understand the format:\n---\nQuestion: Weng earns $12 an
                hour for babysitting. Yesterday, she just did 50 minutes of babysitting.
                How much did she earn?\nReasoning: Weng earns 12/60 = $12/60=0.20.2
                per minute. Working 50 minutes, she earned 0.2 x 50 = $0.2*50=1010.\n
                Final answer: $\\boxed{10}$\n---\nQuestion: Julie is reading a 120-page
                book. Yesterday, she was able to read 12 pages and today, she read
                twice as many pages as yesterday. If she wants to read half of the
                remaining pages tomorrow, how many pages should she read?\nReasoning:
                Julie read 12 x 2 = 12*2=2424 pages today. So she was able to read
                a total of 12 + 24 = 12+24=3636 pages since yesterday. There are 120
                - 36 = 120-36=8484 pages left to be read. Since she wants to read
                half of the remaining pages tomorrow, then she should read 84/2 =
                84/2=4242 pages.\nFinal answer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Reasoning: There are 80/100 * 10 = 80/100*10=88 more purple flowers
                than yellow flowers. So in Mark's garden, there are 10 + 8 = 10+8=1818
                purple flowers. Purple and yellow flowers sum up to 10 + 18 = 10+18=2828
                flowers. That means in Mark's garden there are 25/100 * 28 = 25/100*28=77
                green flowers. So in total Mark has 28 + 7 = 28+7=3535 plants in his
                garden.\nFinal answer: $\\boxed{35}$\n---\nQuestion:"
        format_datasets:
          raw_dir_path: raw
          formatted_dir_path: formatted
          generation_delimiter: false
        generate_answers:
          model: llama3_3b_chat
          max_dataset_size: 10
          sample_strategy: first_n
          max_new_tokens: 1024
          stop_word: '}$'
    outs:
    - path: ./evaluations
      hash: md5
      md5: cf2beb4d0cddc57424e2b130de3f4549.dir
      size: 46405
      nfiles: 11
  capture_activations:
    cmd: python -m src.stages.capture_activations --config=params.yaml --model=llama3_3b_chat
    deps:
    - path: ./generations
      hash: md5
      md5: c6f2e71bed965e5dd98da848a72997d3.dir
      size: 44490
      nfiles: 5
    - path: src/stages/capture_activations.py
      hash: md5
      md5: 5f3e0d43d369b623bb4a35926e3ac678
      size: 5260
    params:
      params.yaml:
        base:
          project_name: correctness-model-internals
          log_level: DEBUG
          models_dir: ../models
          datasets_dir: ./datasets
          generations_dir: ./generations
          evaluations_dir: ./evaluations
          activations_dir: ./activations
        capture_activations:
          input_type:
          - prompt_only
          - prompt_answer
        datasets:
          mmlu:
            answer_type: multiple_choice
            answer_map:
            - A
            - B
            - C
            - D
            subsets:
            - high_school_mathematics
            - college_mathematics
            - abstract_algebra
            prompts:
              base: The following is a multiple choice question (with answers). Give
                your answer with a single letter corresponding to the correct answer.
          gsm8k:
            answer_type: open_ended
            answer_delim: '####'
            answer_regex: (?<=\$\\boxed\{)\d+(?=\}\$)
            subsets:
            - main
            prompts:
              base_3_shot: "Give your answer in this format: $\\boxed{answer}$\nHere
                are some examples to help you understand the format:\n---\nQuestion:
                Weng earns $12 an hour for babysitting. Yesterday, she just did 50
                minutes of babysitting. How much did she earn?\nAnswer: $\\boxed{10}$\n
                ---\nQuestion: Julie is reading a 120-page book. Yesterday, she was
                able to read 12 pages and today, she read twice as many pages as yesterday.
                If she wants to read half of the remaining pages tomorrow, how many
                pages should she read?\nAnswer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Answer: $\\boxed{35}$\n---\nQuestion:"
              cot_3_shot: "Think step by step about the following problem.\nGive your
                answer in this format: $\\boxed{answer}$\nHere are some examples to
                help you understand the format:\n---\nQuestion: Weng earns $12 an
                hour for babysitting. Yesterday, she just did 50 minutes of babysitting.
                How much did she earn?\nReasoning: Weng earns 12/60 = $12/60=0.20.2
                per minute. Working 50 minutes, she earned 0.2 x 50 = $0.2*50=1010.\n
                Final answer: $\\boxed{10}$\n---\nQuestion: Julie is reading a 120-page
                book. Yesterday, she was able to read 12 pages and today, she read
                twice as many pages as yesterday. If she wants to read half of the
                remaining pages tomorrow, how many pages should she read?\nReasoning:
                Julie read 12 x 2 = 12*2=2424 pages today. So she was able to read
                a total of 12 + 24 = 12+24=3636 pages since yesterday. There are 120
                - 36 = 120-36=8484 pages left to be read. Since she wants to read
                half of the remaining pages tomorrow, then she should read 84/2 =
                84/2=4242 pages.\nFinal answer: $\\boxed{42}$\n---\nQuestion: Mark
                has a garden with flowers. He planted plants of three different colors
                in it. Ten of them are yellow, and there are 80% more of those in
                purple. There are only 25% as many green flowers as there are yellow
                and purple flowers. How many flowers does Mark have in his garden?\n
                Reasoning: There are 80/100 * 10 = 80/100*10=88 more purple flowers
                than yellow flowers. So in Mark's garden, there are 10 + 8 = 10+8=1818
                purple flowers. Purple and yellow flowers sum up to 10 + 18 = 10+18=2828
                flowers. That means in Mark's garden there are 25/100 * 28 = 25/100*28=77
                green flowers. So in total Mark has 28 + 7 = 28+7=3535 plants in his
                garden.\nFinal answer: $\\boxed{35}$\n---\nQuestion:"
        generate_answers:
          model: llama3_3b_chat
          max_dataset_size: 10
          sample_strategy: first_n
          max_new_tokens: 1024
          stop_word: '}$'
        models:
          llama3_8b_chat:
            dir_path: llama3_8b_chat_hf
          llama3_8b_cot:
            dir_path: llama3_8b_cot_numina_hf
          llama3_3b_chat:
            dir_path: llama3_3b_chat_hf
    outs:
    - path: ./activations
      hash: md5
      md5: 4c01fe27d17e39e24724b7a78cad30de.dir
      size: 1240900
      nfiles: 10
